<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="592"/>

<div>
<span><div><h1 style="box-sizing: border-box; font-size: 26px; margin: 0px 0px 15px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Promise in js</h1><blockquote style="box-sizing: border-box; padding: 20px; margin: 0px 0px 25px; font-size: 16px; border-left: 6px solid rgb(180, 180, 180); background-color: rgb(247, 247, 247); word-break: break-word; font-weight: normal; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><p style="box-sizing: border-box; margin: 0px; word-break: break-word; font-size: 16px; font-weight: 400;">回调函数真正的问题在于他剥夺了我们使用 return 和 throw 这些关键字的能力。而 Promise 很好地解决了这一切。</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">2015 年 6 月，<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" style="box-sizing: border-box; background-color: transparent; color: rgb(49, 148, 208); text-decoration: none; cursor: pointer;" target="_blank">ECMAScript 6 的正式版</a> 终于发布了。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">ECMAScript 是 JavaScript 语言的国际标准，JavaScript 是 ECMAScript 的实现。ES6 的目标，是使得 JavaScript 语言可以用来编写大型的复杂的应用程序，成为企业级开发语言。</p><h2 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 24px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">概念</h2><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">ES6 原生提供了 Promise 对象。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">所谓 Promise，就是一个对象，用来传递异步操作的消息。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的 API，可供进一步处理。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Promise 对象有以下两个特点。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（1）对象的状态不受外界影响。Promise 对象代表一个异步操作，有三种状态：Pending（进行中）、Resolved（已完成，又称 Fulfilled）和 Rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是 Promise 这个名字的由来，它的英语意思就是「承诺」，表示其他手段无法改变。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">（2）一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise 对象的状态改变，只有两种可能：从 Pending 变为 Resolved 和从 Pending 变为 Rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。就算改变已经发生了，你再对 Promise 对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">有了 Promise 对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，Promise 对象提供统一的接口，使得控制异步操作更加容易。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Promise 也有一些缺点。首先，无法取消 Promise，一旦新建它就会立即执行，无法中途取消。其次，如果不设置回调函数，Promise 内部抛出的错误，不会反应到外部。第三，当处于 Pending 状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> promise = <span style="box-sizing: border-box; color: rgb(133, 153, 0);">new</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">resolve, reject</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">if</span> (<span style="box-sizing: border-box; color: rgb(147, 161, 161);">/* 异步操作成功 */</span>){
 resolve(value);
 } <span style="box-sizing: border-box; color: rgb(133, 153, 0);">else</span> {
 reject(error);
 }
});

promise.then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">value</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">// success</span>
}, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">value</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">// failure</span>
});</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Promise 构造函数接受一个函数作为参数，该函数的两个参数分别是 resolve 方法和 reject 方法。</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">如果异步操作成功，则用 resolve 方法将 Promise 对象的状态，从「未完成」变为「成功」（即从 pending 变为 resolved）；</p><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">如果异步操作失败，则用 reject 方法将 Promise 对象的状态，从「未完成」变为「失败」（即从 pending 变为 rejected）。</p><h2 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 24px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">基本的 api</h2><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 20px; word-break: break-word; padding: 0px; margin-left: 22px; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin-bottom: 10px;">Promise.resolve()</li><li style="box-sizing: border-box; margin-bottom: 10px;">Promise.reject()</li><li style="box-sizing: border-box; margin-bottom: 10px;">Promise.prototype.then()</li><li style="box-sizing: border-box; margin-bottom: 10px;">Promise.prototype.catch()</li><li style="box-sizing: border-box; margin-bottom: 10px;"><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; overflow: visible;">Promise.all() // 所有的完成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"> var p = Promise.all([<span style="box-sizing: border-box; color: rgb(38, 139, 210);">p1</span>,<span style="box-sizing: border-box; color: rgb(38, 139, 210);">p2</span>,<span style="box-sizing: border-box; color: rgb(38, 139, 210);">p3</span>])<span style="box-sizing: border-box; color: rgb(147, 161, 161);">;</span></code></pre></li><li style="box-sizing: border-box; margin-bottom: 10px;">Promise.race() // 竞速，完成一个即可</li></ol><h2 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 24px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">进阶</h2><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">promises 的奇妙在于给予我们以前的 return 与 throw，每个 Promise 都会提供一个 then() 函数，和一个 catch()，实际上是 then(null, ...) 函数，</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">    <span style="box-sizing: border-box;">somePromise</span>()<span style="box-sizing: border-box;">.then</span>(functoin(){
        <span style="box-sizing: border-box; color: rgb(147, 161, 161);">// do something</span>
    });</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">我们可以做三件事，</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"><span style="box-sizing: border-box; color: rgb(42, 161, 152);">1.</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> 另一个 promise
<span style="box-sizing: border-box; color: rgb(42, 161, 152);">2.</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> 一个同步的值 (或者 <span style="box-sizing: border-box;">undefined</span>)
<span style="box-sizing: border-box; color: rgb(42, 161, 152);">3.</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">throw</span> 一个同步异常 `<span style="box-sizing: border-box;"> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">throw</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">new</span> Eror(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">''</span>);</span>`</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">1. 封装同步与异步代码</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">```
new Promise(function (resolve, reject) {
 resolve(someValue);
 });
```
写成

```
Promise.resolve(someValue);
```</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">2. 捕获同步异常</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">new</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span> (<span style="box-sizing: border-box;">resolve, reject</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">throw</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">new</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Error</span>(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">'悲剧了，又出 bug 了'</span>);
 }).catch(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">err</span>)</span>{
 <span style="box-sizing: border-box; color: rgb(38, 139, 210);">console</span>.log(err);
 });</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">如果是同步代码，可以写成</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">    <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.reject(<span style="box-sizing: border-box; color: rgb(133, 153, 0);">new</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Error</span>(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;什么鬼&quot;</span>));</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">3. 多个异常捕获，更加精准的捕获</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">somePromise.then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span><span style="box-sizing: border-box;">()</span> </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> a.b.c.d();
}).<span style="box-sizing: border-box; color: rgb(133, 153, 0);">catch</span>(TypeError, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span><span style="box-sizing: border-box;">(e)</span> </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//If a is defined, will end up here because</span>
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//it is a type error to reference property of undefined</span>
}).<span style="box-sizing: border-box; color: rgb(133, 153, 0);">catch</span>(ReferenceError, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span><span style="box-sizing: border-box;">(e)</span> </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//Will end up here if a wasn't defined at all</span>
}).<span style="box-sizing: border-box; color: rgb(133, 153, 0);">catch</span>(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span><span style="box-sizing: border-box;">(e)</span> </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//Generic catch-the rest, error wasn't TypeError nor</span>
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//ReferenceError</span>
});</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">4. 获取两个 Promise 的返回值</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"><span style="box-sizing: border-box;">1. </span>.then 方式顺序调用
<span style="box-sizing: border-box;">2. </span>设定更高层的作用域
<span style="box-sizing: border-box;">3. </span>spread</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">5. finally</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">任何情况下都会执行的，一般写在 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">catch</span> 之后</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">6. bind</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">somethingAsync().bind({})
.spread(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span> <span style="box-sizing: border-box;">(aValue, bValue)</span> </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">this</span>.aValue = aValue;
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">this</span>.bValue = bValue;
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> somethingElseAsync(aValue, bValue);
})
.then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span> <span style="box-sizing: border-box;">(cValue)</span> </span>{
     <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> <span style="box-sizing: border-box; color: rgb(133, 153, 0);">this</span>.aValue + <span style="box-sizing: border-box; color: rgb(133, 153, 0);">this</span>.bValue + cValue;
});</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">或者 你也可以这样</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">var <span style="box-sizing: border-box; color: rgb(133, 153, 0);">scope </span>= {}<span style="box-sizing: border-box; color: rgb(147, 161, 161);">;</span>
somethingAsync()
.spread(function (aValue, <span style="box-sizing: border-box; color: rgb(133, 153, 0);">bValue) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">scope.aValue </span>= aValue<span style="box-sizing: border-box; color: rgb(147, 161, 161);">;</span>
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">scope.bValue </span>= <span style="box-sizing: border-box; color: rgb(133, 153, 0);">bValue;
</span> return somethingElseAsync(aValue, <span style="box-sizing: border-box; color: rgb(133, 153, 0);">bValue);
</span>})
.then(function (cValue) {
 return <span style="box-sizing: border-box; color: rgb(133, 153, 0);">scope.aValue </span>+ <span style="box-sizing: border-box; color: rgb(133, 153, 0);">scope.bValue </span>+ cValue<span style="box-sizing: border-box; color: rgb(147, 161, 161);">;</span>
})<span style="box-sizing: border-box; color: rgb(147, 161, 161);">;</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">然而，这有非常多的区别，</p><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 20px; word-break: break-word; padding: 0px; margin-left: 22px; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin-bottom: 10px;">你必须先声明，有浪费资源和内存泄露的风险</li><li style="box-sizing: border-box; margin-bottom: 10px;">不能用于放在一个表达式的上下文中</li><li style="box-sizing: border-box; margin-bottom: 10px;">效率更低</li></ol><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">7. all。非常用于于处理一个动态大小均匀的 Promise 列表</h4><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">8. join。非常适用于处理多个分离的 Promise</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">```
<span style="box-sizing: border-box; color: rgb(38, 139, 210);">var</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">join</span> = Promise.<span style="box-sizing: border-box; color: rgb(38, 139, 210);">join</span>;
<span style="box-sizing: border-box; color: rgb(38, 139, 210);">join</span>(getPictures(), getComments(), getTweets(),
 function(pictures, comments, tweets) {
 console.<span style="box-sizing: border-box; color: rgb(38, 139, 210);">log</span>(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;in total: &quot;</span> + pictures.<span style="box-sizing: border-box; color: rgb(38, 139, 210);">length</span> + comments.<span style="box-sizing: border-box; color: rgb(38, 139, 210);">length</span> + tweets.<span style="box-sizing: border-box; color: rgb(38, 139, 210);">length</span>);
});
```</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">9. props。处理一个 promise 的 map 集合。只有有一个失败，所有的执行都结束</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">```
Promise.props({
 <span style="box-sizing: border-box; color: rgb(181, 137, 0);">pictures</span>: getPictures(),
 comments: getComments(),
 tweets: getTweets()
})<span style="box-sizing: border-box; color: rgb(181, 137, 0);">.then</span>(function(result) {
 console<span style="box-sizing: border-box; color: rgb(181, 137, 0);">.log</span>(result<span style="box-sizing: border-box; color: rgb(181, 137, 0);">.tweets</span>, result<span style="box-sizing: border-box; color: rgb(181, 137, 0);">.pictures</span>, result<span style="box-sizing: border-box; color: rgb(181, 137, 0);">.comments</span>);
});
```</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">10. any 、some、race</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">```<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.some([
 ping(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;ns1.example.com&quot;</span>),
 ping(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;ns2.example.com&quot;</span>),
 ping(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;ns3.example.com&quot;</span>),
 ping(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;ns4.example.com&quot;</span>)
], <span style="box-sizing: border-box; color: rgb(42, 161, 152);">2</span>).spread(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">first, second</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(38, 139, 210);">console</span>.log(first, second);
}).catch(AggregateError, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">err</span>) </span>{</span></code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">err.forEach(function(e) {<br style="box-sizing: border-box;"/>
console.error(e.stack);<br style="box-sizing: border-box;"/>
});<br style="box-sizing: border-box;"/>
});;</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">```
有可能，失败的 promise 比较多，导致，Promsie 永远不会 fulfilled</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">11. .map(Function mapper [, Object options])</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">用于处理一个数组，或者 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">promise</span> 数组，</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Option: concurrency 并发现</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">    <span style="box-sizing: border-box;">map</span>(..., {<span style="box-sizing: border-box; color: rgb(181, 137, 0);">concurrency</span>: <span style="box-sizing: border-box; color: rgb(42, 161, 152);">1</span>});</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">以下为不限制并发数量，读书文件信息</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span> = <span style="box-sizing: border-box; color: rgb(38, 139, 210);">require</span>(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;bluebird&quot;</span>);
<span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> join = <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.join;
<span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> fs = <span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.promisifyAll(<span style="box-sizing: border-box; color: rgb(38, 139, 210);">require</span>(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;fs&quot;</span>));
<span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> concurrency = <span style="box-sizing: border-box; color: rgb(38, 139, 210);">parseFloat</span>(process.argv[<span style="box-sizing: border-box; color: rgb(42, 161, 152);">2</span>] || <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;Infinity&quot;</span>);

<span style="box-sizing: border-box; color: rgb(133, 153, 0);">var</span> fileNames = [<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;file1.json&quot;</span>, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;file2.json&quot;</span>];
<span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.map(fileNames, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">fileName</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> fs.readFileAsync(fileName)
 .then(<span style="box-sizing: border-box; color: rgb(38, 139, 210);">JSON</span>.parse)
 .catch(<span style="box-sizing: border-box; color: rgb(38, 139, 210);">SyntaxError</span>, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">e</span>) </span>{
 e.fileName = fileName;
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">throw</span> e;
 })
}, {<span style="box-sizing: border-box;">concurrency</span>: concurrency}).then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">parsedJSONs</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(38, 139, 210);">console</span>.log(parsedJSONs);
}).catch(<span style="box-sizing: border-box; color: rgb(38, 139, 210);">SyntaxError</span>, <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">e</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(38, 139, 210);">console</span>.log(<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;Invalid JSON in file &quot;</span> + e.fileName + <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;: &quot;</span> + e.message);
});</code></pre><p style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">结果</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;">$ sync &amp;&amp; echo <span style="box-sizing: border-box; color: rgb(42, 161, 152);">3</span> &gt; /<span style="box-sizing: border-box; color: rgb(133, 153, 0);">proc</span>/sys/vm/drop_caches
$<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> node</span> test.js 1<span style="box-sizing: border-box; color: rgb(38, 139, 210);">
reading</span> files 35ms
$<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> sync</span> &amp;&amp;<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> echo</span> 3 &gt; /<span style="box-sizing: border-box; color: rgb(133, 153, 0);">proc</span>/sys/vm/drop_caches
$<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> node</span> test.js<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> Infinity</span>
reading<span style="box-sizing: border-box; color: rgb(38, 139, 210);"> files:</span> 9ms</code></pre><h4 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 20px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">11. .reduce(Function reducer [, dynamic initialValue]) -&gt; Promise</h4><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 13px; display: block; padding: 15px; margin: 0px 0px 20px; word-break: break-word; word-wrap: normal; color: rgb(101, 123, 131); background: rgb(246, 246, 246); border: 1px solid rgb(204, 204, 204); border-radius: 0px; text-size-adjust: none; white-space: pre; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(101, 123, 131); background-color: transparent; border-radius: 0px; padding: 0px; white-space: pre; border: none;"><span style="box-sizing: border-box; color: rgb(38, 139, 210);">Promise</span>.reduce([<span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;file1.txt&quot;</span>, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;file2.txt&quot;</span>, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;file3.txt&quot;</span>], <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">total, fileName</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> fs.readFileAsync(fileName, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">&quot;utf8&quot;</span>).then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">contents</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(133, 153, 0);">return</span> total + <span style="box-sizing: border-box; color: rgb(38, 139, 210);">parseInt</span>(contents, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">10</span>);
 });
}, <span style="box-sizing: border-box; color: rgb(42, 161, 152);">0</span>).then(<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: rgb(133, 153, 0);">function</span>(<span style="box-sizing: border-box;">total</span>) </span>{
 <span style="box-sizing: border-box; color: rgb(147, 161, 161);">//Total is 30</span>
});</code></pre><h3 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 22px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">12. Time</h3><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 20px; word-break: break-word; padding: 0px; margin-left: 22px; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin-bottom: 10px;">.delay(int ms) -&gt; Promise</li><li style="box-sizing: border-box; margin-bottom: 10px;">.timeout(int ms [, String message]) -&gt; Promise</li></ol><h2 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 24px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">Promise 的实现</h2><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 20px; word-break: break-word; padding: 0px; margin-left: 22px; color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><li style="box-sizing: border-box; margin-bottom: 10px;"><a href="https://github.com/kriskowal/q" style="box-sizing: border-box; background-color: transparent; color: rgb(49, 148, 208); text-decoration: none; cursor: pointer;" target="_blank">q</a></li><li style="box-sizing: border-box; margin-bottom: 10px;"><a href="https://github.com/petkaantonov/bluebird" style="box-sizing: border-box; background-color: transparent; color: rgb(49, 148, 208); text-decoration: none; cursor: pointer;" target="_blank">bluebird</a></li><li style="box-sizing: border-box; margin-bottom: 10px;"><a href="https://github.com/tj/co" style="box-sizing: border-box; background-color: transparent; color: rgb(49, 148, 208); text-decoration: none; cursor: pointer;" target="_blank">co</a></li><li style="box-sizing: border-box; margin-bottom: 10px;"><a href="https://github.com/cujojs/when" style="box-sizing: border-box; background-color: transparent; color: rgb(49, 148, 208); text-decoration: none; cursor: pointer;" target="_blank">when</a></li></ol><h2 style="box-sizing: border-box; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-weight: 700; color: rgb(47, 47, 47); margin: 0px 0px 15px; font-size: 24px; text-rendering: optimizeLegibility; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">ASYNC</h2><div style="box-sizing: border-box; margin: 0px 0px 25px; word-break: break-word; color: rgb(47, 47, 47); font-family: -apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif; font-size: 16px; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div>async 函数与 Promise、Generator 函数一样，是用来取代回调函数、解决异步操作的一种方法。它本质上是 Generator 函数的语法糖。async 函数并不属于 ES6，而是被列入了 ES7。</div></div></div></span>
</div></body></html> 